<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the multiverse in RMarkdown: Introduction to multiverse code chunks • multiverse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using the multiverse in RMarkdown: Introduction to multiverse code chunks">
<meta property="og:description" content="multiverse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multiverse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/branch.html">A discussion on branches in the multiverse</a>
    </li>
    <li>
      <a href="../articles/conditions.html">Declaring conditions in the multiverse</a>
    </li>
    <li>
      <a href="../articles/dance.html">Example multiverse implementation: Recreating Adding inferential treatments to plots using Resampling and Animations using multiverse</a>
    </li>
    <li>
      <a href="../articles/durante-multiverse-analysis.html">Example multiverse implementation: Effect of fertility on religiosity and political attitudes</a>
    </li>
    <li>
      <a href="../articles/frequentist-multiverse-analysis.html">Example multiverse implementation: Re-evaluating the efficiency of physical visualizations</a>
    </li>
    <li>
      <a href="../articles/hurricane.html">Example multiverse implementation: Female hurricanes are deadlier than male hurricanes</a>
    </li>
    <li>
      <a href="../articles/multiverse-export-json.html">multiverse-export-json</a>
    </li>
    <li>
      <a href="../articles/multiverse-in-rmd.html">Using the multiverse in RMarkdown: Introduction to multiverse code chunks</a>
    </li>
    <li>
      <a href="../articles/visualising-multiverse.html">Extracting and Visualising the results of a multiverse analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MUCollective/multiverse/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="multiverse-in-rmd_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the multiverse in RMarkdown: Introduction to multiverse code chunks</h1>
                        <h4 class="author">Abhraneel Sarma</h4>
            
            <h4 class="date">2022-02-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MUCollective/multiverse/blob/master/vignettes/multiverse-in-rmd.Rmd"><code>vignettes/multiverse-in-rmd.Rmd</code></a></small>
      <div class="hidden name"><code>multiverse-in-rmd.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mucollective.github.io/multiverse/">multiverse</a></span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this document we will describe the usage of the multiverse code block. The multiverse code block is an alternative to the R code block which will parse any code run in it directly in the multiverse, and reduces the need for auxiliary functions such as (inside). In addition, the default analysis in the multiverse will be executed in the environment in which the multiverse has been declared, which would usually be the global environment. In that case the results of the default analysis can be inspected directly in an R code block, similar to what an user would do if they were running a single universe analysis.</p>
<p>We demonstrate how the two methods are equivalent, and result in the same multiverse.</p>
<p>In this example, we will use the data which compares different modalities for physical visualizations. See (frequentist-multiverse-analysis) for more details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"userlogs"</span><span class="op">)</span></code></pre></div>
<p>As with any multiverse analysis, we first need to define the multiverse object. This step is the same for both methods. We will define two separate objects for illustrating the two different ways of adding code to the multiverse for analysis. In the multiverse analysis in this vignette, we will perform a log transformation on the duration variable of the dataset using both the <code>inside</code> function as well as the <code>multiverse code block</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M_inside</span> <span class="op">=</span> <span class="fu"><a href="../reference/multiverse.html">multiverse</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">M_block</span> <span class="op">=</span> <span class="fu"><a href="../reference/multiverse.html">multiverse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="inside-and-multiverse-analysis-in-r-scripts" class="section level2">
<h2 class="hasAnchor">
<a href="#inside-and-multiverse-analysis-in-r-scripts" class="anchor"></a>Inside() and Multiverse analysis in R scripts</h2>
<p>The idea of the inside function is to allow us to write code to be executed within the multiverse and not directly in R, thus allowing us to make use of a flexible syntax for declaring the different possible analysis combinations within the multiverse. The inside function takes two arguments:</p>
<ol style="list-style-type: decimal">
<li>the name of the multiverse object</li>
<li>the expression (code) to be passed into the multiverse enclosed within a pair of curly braces, <code>{</code>
</li>
</ol>
<p>The expression passed into the multiverse is not executed directly, allowing us to parse and expand the expression provided by the user has declared using our <code>branch</code> and <code>parameters</code>, into their corresponding analysis combinations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M_inside</span>, <span class="op">{</span>
    <span class="va">data_transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">data_transform</span>,
        <span class="st">"log-transformed"</span> <span class="op">~</span> <span class="va">log</span>,
        <span class="st">"untransformed"</span> <span class="op">~</span> <span class="va">identity</span>
      <span class="op">)</span>
    
    <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">data_transform</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">userlogs</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
<div id="multiverse-in-rmarkdown" class="section level2">
<h2 class="hasAnchor">
<a href="#multiverse-in-rmarkdown" class="anchor"></a>Multiverse in RMarkdown</h2>
<p>Although the inside function is the only way to add code to the multiverse in an RScript, RMarkdown notebooks allow us the opportunity to use different language engines (not just limited to R). This flexibility also provides an opportunity to write multiverse code directly into a code block, instead of using auxillary functions.</p>
<p>The language associated with a code block is provided by the first argument: <code>```{r}</code> Here the first argument is <code>r</code> hence the code in the associated block will be executed in R. To convert a code block to execute in multiverse, change the first argument to <code>multiverse</code>. Thus the code block would be: <code>```{multiverse}</code></p>
<p>To execute a code block in multiverse, the user needs to provide two additional arguments: <code>label</code> and <code>inside</code>.</p>
<p>The label is a unique identifier for the code block, and each code block in the same document must have a different label. However, the label argument does not need to be explicitly specified (as is the case with an R code block). Therefore, <code>```{multiverse, label=default-m-1 ...}</code>, <code>```{multiverse, default-m-1 ...}</code> and <code>```{multiverse default-m-1 ...}</code> are all equivalent.</p>
<p>The inside argument takes in only multiverse objects, and is used to indicate the multiverse object which will the code inside the code block will be associated with. Thus declaring a multiverse code block would be: <code>```{multiverse, default-m-1, inside = M}</code></p>
<p>We provide the ability to declare multiverse code block as an <em>AddIn</em> in RStudio. Users can click on <em>AddIns</em> toolbar menu in RStudio (see the image below). This would create a multiverse code block at the location of the cursor in the document.</p>
<p><img src="figures/01-multiverse-addins.png" width="90%"></p>
<p>Alternately, users can insert a multiverse We also allow users to create a keyboard shortcut to declare a multiverse code block inside a RMarkdown document. This can be done through the following steps:</p>
<ul>
<li>Tools &gt; AddIns &gt; Browse AddIns… &gt; Keyboard Shortcuts</li>
<li>Next, in the filter input field, type <em>multiverse</em>. You will see one result with “Insert multiverse code chunk” as the name.</li>
<li>Click on the Shortcut field and press Cmd+Option+M (on Mac OS) or Ctrl+Shift+Alt+M (on Windows).</li>
<li>Click “Apply” and exit the dialog box</li>
</ul>
<div id="multiverse-code-block" class="section level3">
<h3 class="hasAnchor">
<a href="#multiverse-code-block" class="anchor"></a>Multiverse code block</h3>
<p>The declaration of the chunk below is (this gets hidden when we knit the document): <code>```{multiverse default-m-1, inside = M_block}</code></p>
<pre><code>```{multiverse default-m-1, inside = M_block}
data_transform &lt;- branch(data_transform,
    "log-transformed" ~ log,
    "untransformed" ~ identity
  )

duration &lt;- do.call(data_transform, list(userlogs$duration))
```</code></pre>
<p>The result of this code block will be identical to the result using <code><a href="../reference/inside.html">inside()</a></code>. We first compare whether the multiverse table is generated properly for both the multiverse objects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M_inside</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   .universe data_transform  .parameter_assignment .code            .results
##       &lt;int&gt; &lt;chr&gt;           &lt;list&gt;                &lt;list&gt;           &lt;list&gt;  
## 1         1 log-transformed &lt;named list [1]&gt;      &lt;named list [1]&gt; &lt;env&gt;   
## 2         2 untransformed   &lt;named list [1]&gt;      &lt;named list [1]&gt; &lt;env&gt;</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M_block</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   .universe data_transform  .parameter_assignment .code            .results
##       &lt;int&gt; &lt;chr&gt;           &lt;list&gt;                &lt;list&gt;           &lt;list&gt;  
## 1         1 log-transformed &lt;named list [1]&gt;      &lt;named list [1]&gt; &lt;env&gt;   
## 2         2 untransformed   &lt;named list [1]&gt;      &lt;named list [1]&gt; &lt;env&gt;</code></pre>
<p>As you can see above, both the methods yield the same multiverse table. Next, we inspect the <code>.code</code> column of the multiverse object. This column contains the code used to generate each analysis combination in the multiverse. The only differences here arise from how the expressions are stored. The multiverse code block creates a named list, whereas the inside function creates a unnamed list for each row of this column.</p>
<p>Below is the output from the first multiverse object (<code>M_inside</code>), which uses the inside function:</p>
<pre><code>## [[1]]
## [[1]]$`1`
## {
##     data_transform &lt;- log
##     duration &lt;- do.call(data_transform, list(userlogs$duration))
## }
## 
## 
## [[2]]
## [[2]]$`1`
## {
##     data_transform &lt;- identity
##     duration &lt;- do.call(data_transform, list(userlogs$duration))
## }</code></pre>
<p>This is the output from the second multiverse object (<code>M_block</code>), which uses the multiverse code block:</p>
<pre><code>## [[1]]
## [[1]]$`default-m-1`
## {
##     data_transform &lt;- log
##     duration &lt;- do.call(data_transform, list(userlogs$duration))
## }
## 
## 
## [[2]]
## [[2]]$`default-m-1`
## {
##     data_transform &lt;- identity
##     duration &lt;- do.call(data_transform, list(userlogs$duration))
## }</code></pre>
</div>
</div>
<div id="notes-on-using-multiverse-code-blocks" class="section level2">
<h2 class="hasAnchor">
<a href="#notes-on-using-multiverse-code-blocks" class="anchor"></a>Notes on using multiverse code blocks</h2>
<div id="in-rstudio-using-rmarkdown" class="section level3">
<h3 class="hasAnchor">
<a href="#in-rstudio-using-rmarkdown" class="anchor"></a>In RStudio using RMarkdown</h3>
<p>During interactive use with RStudio, <em>multiverse code blocks</em> will work very similarly to a R code block. It will only execute the default analysis (i.e. the analysis path obtained by combining the first option of each parameter) in the global environment. Any output that is generated will have the formatting that output of R code blocks do.</p>
</div>
<div id="knitting-to-html-using-knitr" class="section level3">
<h3 class="hasAnchor">
<a href="#knitting-to-html-using-knitr" class="anchor"></a>Knitting to HTML using knitr</h3>
<p>When a document is knit, currently all analysis paths are executed but the document only shows the analysis path corresponding to the default analysis. We are currently developing interactive features which will allow the author to implement interactivity into the rendered HTML document; this will also allow readers to interact with the analysis and investigate the robustness of the implemented analysis themselves.</p>
</div>
<div id="knitting-to-html-using-knitr-1" class="section level3">
<h3 class="hasAnchor">
<a href="#knitting-to-html-using-knitr-1" class="anchor"></a>Knitting to HTML using knitr</h3>
<p>Currently we do not support knitting of RMarkdown documents with multiverse code blocks to PDF documents.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://abhsarma.github.io">Abhraneel Sarma</a>, Michael Moon, <a href="http://www.mjskay.com">Matthew Kay</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
