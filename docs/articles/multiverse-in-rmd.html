<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using the multiverse in RMarkdown: Introduction to multiverse code chunks • multiverse</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Georgia-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using the multiverse in RMarkdown: Introduction to multiverse code chunks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multiverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/branch.html">A discussion on branches in the multiverse</a></li>
    <li><a class="dropdown-item" href="../articles/conditions.html">Declaring conditions in the multiverse</a></li>
    <li><a class="dropdown-item" href="../articles/example-dance.html">Example multiverse implementation: Recreating Adding inferential treatments to plots using Resampling and Animations using multiverse</a></li>
    <li><a class="dropdown-item" href="../articles/example-durante.html">Example multiverse implementation: Effect of fertility on religiosity and political attitudes</a></li>
    <li><a class="dropdown-item" href="../articles/example-frequentist.html">Example multiverse implementation: Re-evaluating the efficiency of physical visualizations</a></li>
    <li><a class="dropdown-item" href="../articles/example-hurricane.html">Example multiverse implementation: Female hurricanes are deadlier than male hurricanes</a></li>
    <li><a class="dropdown-item" href="../articles/execution-multiverse.html">Execution of multiverse analysis --- Sequential and Parallel</a></li>
    <li><a class="dropdown-item" href="../articles/multiverse-in-rmd.html">Using the multiverse in RMarkdown: Introduction to multiverse code chunks</a></li>
    <li><a class="dropdown-item" href="../articles/visualising-multiverse.html">Extracting and Visualising the results of a multiverse analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MUCollective/multiverse/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using the multiverse in RMarkdown: Introduction to multiverse code chunks</h1>
                        <h4 data-toc-skip class="author">Abhraneel
Sarma</h4>
            
            <h4 data-toc-skip class="date">2024-09-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MUCollective/multiverse/blob/HEAD/vignettes/multiverse-in-rmd.Rmd" class="external-link"><code>vignettes/multiverse-in-rmd.Rmd</code></a></small>
      <div class="d-none name"><code>multiverse-in-rmd.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mucollective.github.io/multiverse/" class="external-link">multiverse</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this document we will describe the usage of the multiverse code
block. The multiverse code block is an alternative to the R code block
which will parse any code run in it directly in the multiverse, and
reduces the need for auxiliary functions such as (inside). In addition,
the default analysis in the multiverse will be executed in the
environment in which the multiverse has been declared, which would
usually be the global environment. In that case the results of the
default analysis can be inspected directly in an R code block, similar
to what an user would do if they were running a single universe
analysis.</p>
<p>We demonstrate how the two methods are equivalent, and result in the
same multiverse.</p>
<p>In this example, we will use the data which compares different
modalities for physical visualizations. See
(frequentist-multiverse-analysis) for more details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"userlogs"</span><span class="op">)</span></span></code></pre></div>
<p>As with any multiverse analysis, we first need to define the
multiverse object. This step is the same for both methods. We will
define two separate objects for illustrating the two different ways of
adding code to the multiverse for analysis. In the multiverse analysis
in this vignette, we will perform a log transformation on the duration
variable of the dataset using both the <code>inside</code> function as
well as the <code>multiverse code block</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M_inside</span> <span class="op">=</span> <span class="fu"><a href="../reference/multiverse.html">multiverse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">M_block</span> <span class="op">=</span> <span class="fu"><a href="../reference/multiverse.html">multiverse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="inside-and-multiverse-analysis-in-r-scripts">Inside() and Multiverse analysis in R scripts<a class="anchor" aria-label="anchor" href="#inside-and-multiverse-analysis-in-r-scripts"></a>
</h2>
<p>The idea of the inside function is to allow us to write code to be
executed within the multiverse and not directly in R, thus allowing us
to make use of a flexible syntax for declaring the different possible
analysis combinations within the multiverse. The inside function takes
two arguments:</p>
<ol style="list-style-type: decimal">
<li>the name of the multiverse object</li>
<li>the expression (code) to be passed into the multiverse enclosed
within a pair of curly braces, <code>{</code>
</li>
</ol>
<p>The expression passed into the multiverse is not executed directly,
allowing us to parse and expand the expression provided by the user has
declared using our <code>branch</code> and <code>parameters</code>, into
their corresponding analysis combinations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M_inside</span>, <span class="op">{</span></span>
<span>    <span class="va">data_transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">data_transform</span>,</span>
<span>        <span class="st">"log-transformed"</span> <span class="op">~</span> <span class="va">log</span>,</span>
<span>        <span class="st">"untransformed"</span> <span class="op">~</span> <span class="va">identity</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">data_transform</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">userlogs</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multiverse-in-rmarkdown">Multiverse in RMarkdown<a class="anchor" aria-label="anchor" href="#multiverse-in-rmarkdown"></a>
</h2>
<p>Although the inside function is the only way to add code to the
multiverse in an RScript, RMarkdown notebooks allow us the opportunity
to use different language engines (not just limited to R). This
flexibility also provides an opportunity to write multiverse code
directly into a code block, instead of using auxillary functions.</p>
<p>The language associated with a code block is provided by the first
argument: <code>```{r}</code> Here the first argument is <code>r</code>
hence the code in the associated block will be executed in R. To convert
a code block to execute in multiverse, change the first argument to
<code>multiverse</code>. Thus the code block would be:
<code>```{multiverse}</code></p>
<p>To execute a code block in multiverse, the user needs to provide two
additional arguments: <code>label</code> and <code>inside</code>.</p>
<p>The label is a unique identifier for the code block, and each code
block in the same document must have a different label. However, the
label argument does not need to be explicitly specified (as is the case
with an R code block). Therefore,
<code>```{multiverse, label=default-m-1 ...}</code>,
<code>```{multiverse, default-m-1 ...}</code> and
<code>```{multiverse default-m-1 ...}</code> are all equivalent.</p>
<p>The inside argument takes in only multiverse objects, and is used to
indicate the multiverse object which will the code inside the code block
will be associated with. Thus declaring a multiverse code block would
be: <code>```{multiverse, default-m-1, inside = M}</code></p>
<p>We provide the ability to declare multiverse code block as an
<em>AddIn</em> in RStudio. Users can click on <em>AddIns</em> toolbar
menu in RStudio (see the image below). This would create a multiverse
code block at the location of the cursor in the document.</p>
<p><img src="figures/01-multiverse-addins.png" width="90%"></p>
<p>Alternately, users can insert a multiverse We also allow users to
create a keyboard shortcut to declare a multiverse code block inside a
RMarkdown document. This can be done through the following steps:</p>
<ul>
<li>Tools &gt; AddIns &gt; Browse AddIns… &gt; Keyboard Shortcuts</li>
<li>Next, in the filter input field, type <em>multiverse</em>. You will
see one result with “Insert multiverse code chunk” as the name.</li>
<li>Click on the Shortcut field and press Cmd+Option+M (on Mac OS) or
Ctrl+Shift+Alt+M (on Windows).</li>
<li>Click “Apply” and exit the dialog box</li>
</ul>
<p>If you are experiencing issues creating a keyboard shortcut for code
blocks, or if you are experiencing a situation where the shortcut needs
to be re-created everytime you open a new RStudio session, please refer
to the <code>Debugging Keyboard Shortcuts</code> section at the end of
this document.</p>
<div class="section level3">
<h3 id="multiverse-code-block">Multiverse code block<a class="anchor" aria-label="anchor" href="#multiverse-code-block"></a>
</h3>
<p>The declaration of the chunk below is (this gets hidden when we knit
the document):
<code>```{multiverse default-m-1, inside = M_block}</code></p>
<pre><code>```{multiverse default-m-1, inside = M_block}
data_transform &lt;- branch(data_transform,
    "log-transformed" ~ log,
    "untransformed" ~ identity
  )

duration &lt;- do.call(data_transform, list(userlogs$duration))
```</code></pre>
<p>The result of this code block will be identical to the result using
<code><a href="../reference/inside.html">inside()</a></code>. We first compare whether the multiverse table is
generated properly for both the multiverse objects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M_inside</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">##   .universe data_transform  .parameter_assignment .code        .results .errors</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 log-transformed <span style="color: #949494;">&lt;named list [1]&gt;</span>      <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;env&gt;</span>    <span style="color: #949494;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2 untransformed   <span style="color: #949494;">&lt;named list [1]&gt;</span>      <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;env&gt;</span>    <span style="color: #949494;">&lt;lgl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M_block</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">##   .universe data_transform  .parameter_assignment .code        .results .errors</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 log-transformed <span style="color: #949494;">&lt;named list [1]&gt;</span>      <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;env&gt;</span>    <span style="color: #949494;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2 untransformed   <span style="color: #949494;">&lt;named list [1]&gt;</span>      <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;env&gt;</span>    <span style="color: #949494;">&lt;lgl&gt;</span></span></span></code></pre>
<p>As you can see above, both the methods yield the same multiverse
table. Next, we inspect the <code>.code</code> column of the multiverse
object. This column contains the code used to generate each analysis
combination in the multiverse. The only differences here arise from how
the expressions are stored. The multiverse code block creates a named
list, whereas the inside function creates a unnamed list for each row of
this column.</p>
<p>Below is the output from the first multiverse object
(<code>M_inside</code>), which uses the inside function:</p>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [[1]]$`1`</span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     data_transform &lt;- log</span></span>
<span><span class="co">##     duration &lt;- do.call(data_transform, list(userlogs$duration))</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [[2]]$`1`</span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     data_transform &lt;- identity</span></span>
<span><span class="co">##     duration &lt;- do.call(data_transform, list(userlogs$duration))</span></span>
<span><span class="co">## }</span></span></code></pre>
<p>This is the output from the second multiverse object
(<code>M_block</code>), which uses the multiverse code block:</p>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [[1]]$`default-m-1`</span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     data_transform &lt;- log</span></span>
<span><span class="co">##     duration &lt;- do.call(data_transform, list(userlogs$duration))</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [[2]]$`default-m-1`</span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     data_transform &lt;- identity</span></span>
<span><span class="co">##     duration &lt;- do.call(data_transform, list(userlogs$duration))</span></span>
<span><span class="co">## }</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="notes-on-using-multiverse-code-blocks">Notes on using multiverse code blocks<a class="anchor" aria-label="anchor" href="#notes-on-using-multiverse-code-blocks"></a>
</h2>
<div class="section level3">
<h3 id="in-rstudio-using-rmarkdown">In RStudio using RMarkdown<a class="anchor" aria-label="anchor" href="#in-rstudio-using-rmarkdown"></a>
</h3>
<p>During interactive use with RStudio, <em>multiverse code blocks</em>
will work very similarly to a R code block. It will only execute the
default analysis (i.e. the analysis path obtained by combining the first
option of each parameter) in the global environment. Any output that is
generated will have the formatting that output of R code blocks do.</p>
</div>
<div class="section level3">
<h3 id="knitting-to-html-using-knitr">Knitting to HTML using knitr<a class="anchor" aria-label="anchor" href="#knitting-to-html-using-knitr"></a>
</h3>
<p>When a document is knit, currently all analysis paths are executed
but the document only shows the analysis path corresponding to the
default analysis. We are currently developing interactive features which
will allow the author to implement interactivity into the rendered HTML
document; this will also allow readers to interact with the analysis and
investigate the robustness of the implemented analysis themselves.</p>
</div>
<div class="section level3">
<h3 id="knitting-to-html-using-knitr-1">Knitting to HTML using knitr<a class="anchor" aria-label="anchor" href="#knitting-to-html-using-knitr-1"></a>
</h3>
<p>Currently we do not support knitting of RMarkdown documents with
multiverse code blocks to PDF documents.</p>
</div>
</div>
<div class="section level2">
<h2 id="debugging-keyboard-shortcuts">Debugging Keyboard Shortcuts<a class="anchor" aria-label="anchor" href="#debugging-keyboard-shortcuts"></a>
</h2>
<div class="section level3">
<h3 id="on-os-x-systems">On OS X Systems<a class="anchor" aria-label="anchor" href="#on-os-x-systems"></a>
</h3>
<p>One issue that I have encountered in the past, is that I had to
create the keyboard shortcut everytime I opened a new RStudio session.
As discussed here, RStudio keybindings are saves as JSON files in the
directory <code>~/.R/rstudio/keybindings/</code>, but this directory was
missing for me.</p>
<p>Check if the directory exists for you: 1. Open Terminal 2. Enter:
<code>cd ~/.config/rstudio/keybindings</code></p>
<p>If it returns an error such as
<code>cd: no such file or directory</code>, this means that you do not
have the directory. The fix is to create this directory which can be
done through the following steps:</p>
<ol style="list-style-type: decimal">
<li>Open Terminal</li>
<li>Enter <code>mkdir ~/.config/rstudio/keybindings/</code>
</li>
</ol>
<p>If it returns “Permission denied” you might have to run the command
as the superuser in the Terminal:
<code>sudo mkdir ~/.config/rstudio/keybindings/</code> This will request
you to enter your login password.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://abhsarma.github.io" class="external-link">Abhraneel Sarma</a>, <a href="http://www.mjskay.com" class="external-link">Matthew Kay</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
