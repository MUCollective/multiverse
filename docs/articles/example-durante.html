<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example multiverse implementation: Effect of fertility on religiosity and political attitudes • multiverse</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Georgia-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example multiverse implementation: Effect of fertility on religiosity and political attitudes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multiverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/branch.html">A discussion on branches in the multiverse</a></li>
    <li><a class="dropdown-item" href="../articles/conditions.html">Declaring conditions in the multiverse</a></li>
    <li><a class="dropdown-item" href="../articles/example-dance.html">Example multiverse implementation: Recreating Adding inferential treatments to plots using Resampling and Animations using multiverse</a></li>
    <li><a class="dropdown-item" href="../articles/example-durante.html">Example multiverse implementation: Effect of fertility on religiosity and political attitudes</a></li>
    <li><a class="dropdown-item" href="../articles/example-frequentist.html">Example multiverse implementation: Re-evaluating the efficiency of physical visualizations</a></li>
    <li><a class="dropdown-item" href="../articles/example-hurricane.html">Example multiverse implementation: Female hurricanes are deadlier than male hurricanes</a></li>
    <li><a class="dropdown-item" href="../articles/execution-multiverse.html">Execution of multiverse analysis --- Sequential and Parallel</a></li>
    <li><a class="dropdown-item" href="../articles/multiverse-in-rmd.html">Using the multiverse in RMarkdown: Introduction to multiverse code chunks</a></li>
    <li><a class="dropdown-item" href="../articles/visualising-multiverse.html">Extracting and Visualising the results of a multiverse analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MUCollective/multiverse/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example multiverse implementation: Effect of fertility on religiosity and political attitudes</h1>
                        <h4 data-toc-skip class="author">Abhraneel
Sarma, Northwestern University</h4>
            
            <h4 data-toc-skip class="date">2024-09-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MUCollective/multiverse/blob/HEAD/vignettes/example-durante.Rmd" class="external-link"><code>vignettes/example-durante.Rmd</code></a></small>
      <div class="d-none name"><code>example-durante.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="multiverse-case-study-1">Multiverse case study #1<a class="anchor" aria-label="anchor" href="#multiverse-case-study-1"></a>
</h2>
<p>In this document, we outline an initial approach to conducting a
multiverse analysis in R. We will show how our package can be used to
perform the multiverse analysis outlined by Steegen et al. in <a href="https://doi.org/10.1177/1745691616658637" class="external-link">Increasing Transparency
Through a Multiverse Analysis</a>.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Data analysis can involve several decisions involving two or more
options. In most statistical analysis, these decisions are taken by the
researcher based on some reasonable justification. However, for several
decisions, there can be more than one reasonable options to choose from.
A multiverse analysis is a form of analysis which makes all such
decisions explicit and conducts the complete analysis for all
combinations of options (of each decision).</p>
<p>Below, we illustrate an example of a single analysis for a dataset.
And then extend it to a multiverse analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mucollective.github.io/multiverse/" class="external-link">multiverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-data">The data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>The first step is to read the raw data from the file and store it as
a tibble. We will be following the <em><em>tidy data</em></em> format
here. The data is stored in two text files, and we can use
<code>readr</code> to read the files into R. In this example, we will
use the data collected by <em>Durante et al.</em> in <a href="https://doi.org/10.1177/0956797612466416" class="external-link">The fluctuating female
vote: Politics, religion, and the ovulatory cycle</a>, which
investigated the effect of fertility on religiosity and political
attitudes. We will focus on their second study (which we store in
<code>data.raw.study2</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"durante"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data.raw.study2</span> <span class="op">&lt;-</span> <span class="va">durante</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Abortion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">7</span> <span class="op">-</span> <span class="va">Abortion</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    StemCell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">7</span> <span class="op">-</span> <span class="va">StemCell</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    Marijuana <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">7</span> <span class="op">-</span> <span class="va">Marijuana</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    RichTax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">7</span> <span class="op">-</span> <span class="va">RichTax</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    StLiving <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">7</span> <span class="op">-</span> <span class="va">StLiving</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    Profit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">7</span> <span class="op">-</span> <span class="va">Profit</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    FiscConsComp <span class="op">=</span> <span class="va">FreeMarket</span> <span class="op">+</span> <span class="va">PrivSocialSec</span> <span class="op">+</span> <span class="va">RichTax</span> <span class="op">+</span> <span class="va">StLiving</span> <span class="op">+</span> <span class="va">Profit</span>,</span>
<span>    SocConsComp <span class="op">=</span> <span class="va">Marriage</span> <span class="op">+</span> <span class="va">RestrictAbortion</span> <span class="op">+</span> <span class="va">Abortion</span> <span class="op">+</span> <span class="va">StemCell</span> <span class="op">+</span> <span class="va">Marijuana</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The data look like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data.raw.study2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 26</span></span></span>
<span><span class="co">##    WorkerID  Rel1  Rel2  Rel3 Abortion Marriage StemCell RestrictAbortion</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        1     8     8     7        6        7        1                7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        2     8     7     7        1        2        3                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        3     6     6     2        5        1        2                4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        4     7     8     6        1        5        2                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        5     7     7     9        1        1        4                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        6     9     9     9        7        7        2                7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        7     5     8     5        3        4        3                5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        8     1     1     1        1        1        2                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        9     7     7     7        5        1        2                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>       10     6     6     6        3        5        3                1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 18 more variables: Marijuana &lt;dbl&gt;, FreeMarket &lt;dbl&gt;, RichTax &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StLiving &lt;dbl&gt;, Profit &lt;dbl&gt;, PrivSocialSec &lt;dbl&gt;, Sure1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Sure2 &lt;dbl&gt;, Relationship &lt;dbl&gt;, ReportedCycleLength &lt;dbl&gt;, Vote &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Donate &lt;dbl&gt;, DateTesting &lt;date&gt;, StartDateofLastPeriod &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StartDateofPeriodBeforeLast &lt;date&gt;, StartDateNext &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   FiscConsComp &lt;dbl&gt;, SocConsComp &lt;dbl&gt;</span></span></span></code></pre>
<p>The original paper looked at the relationship between fertility,
relationship status, and religiosity. But there are many reasonable ways
to have defined each of these three variables from this dataset, so it
is a good candidate for multiverse analysis.</p>
</div>
<div class="section level2">
<h2 id="a-single-data-set-analysis-one-possible-analysis-among-many">A single data set analysis: one possible analysis among many<a class="anchor" aria-label="anchor" href="#a-single-data-set-analysis-one-possible-analysis-among-many"></a>
</h2>
<p>The data collected needs to be processed before it can be modeled.
Preparing the data set for analysis can involve several steps and
decisions regarding how to encode the different raw values. The
following is one example of data processing that can be performed for
this study.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_universe</span> <span class="op">=</span> <span class="va">data.raw.study2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> ComputedCycleLength <span class="op">=</span> <span class="va">StartDateofLastPeriod</span> <span class="op">-</span> <span class="va">StartDateofPeriodBeforeLast</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> NextMenstrualOnset <span class="op">=</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ComputedCycleLength</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    CycleDay <span class="op">=</span> <span class="fl">28</span> <span class="op">-</span> <span class="op">(</span><span class="va">NextMenstrualOnset</span> <span class="op">-</span> <span class="va">DateTesting</span><span class="op">)</span>,</span>
<span>    CycleDay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">WorkerID</span> <span class="op">==</span> <span class="fl">15</span>, <span class="fl">11</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">WorkerID</span> <span class="op">==</span> <span class="fl">16</span>, <span class="fl">18</span>, <span class="va">CycleDay</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    CycleDay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;</span> <span class="fl">28</span>, <span class="va">CycleDay</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Relationship <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Relationship</span><span class="op">==</span><span class="fl">2</span>, <span class="st">"Single"</span>, <span class="st">"Relationship"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span> <span class="va">ComputedCycleLength</span> <span class="op">&gt;</span> <span class="fl">25</span> <span class="op">&amp;</span> <span class="va">ComputedCycleLength</span> <span class="op">&lt;</span> <span class="fl">35</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span> <span class="va">Sure1</span> <span class="op">&gt;</span> <span class="fl">6</span> <span class="op">|</span> <span class="va">Sure2</span> <span class="op">&gt;</span> <span class="fl">6</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> Fertility <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">14</span>, <span class="st">"high"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">17</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">25</span>, <span class="st">"low"</span>, <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p>The transformed data for this one universe looks like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_universe</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span> <span class="va">NextMenstrualOnset</span>, <span class="va">Relationship</span>, <span class="va">Sure1</span>, <span class="va">Sure2</span>, <span class="va">Fertility</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 30</span></span></span>
<span><span class="co">##    NextMenstrualOnset Relationship Sure1 Sure2 Fertility WorkerID  Rel1  Rel2</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2012-06-17         Relationship     9     9 medium           1     8     8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2012-05-28         Relationship     9     7 low              2     8     7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2012-05-31         Relationship     8     7 low              3     6     6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2012-05-23         Single           8     8 medium           6     9     9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2012-05-31         Relationship     9     9 low              7     5     8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2012-06-15         Single           8     8 medium          11     2     5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2012-06-08         Relationship     9     8 high            12     7     7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2012-06-14         Relationship     9     8 medium          13     9     9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2012-06-10         Relationship     9     9 high            17     6     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2012-06-18         Single           9     9 medium          18     9     9</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 22 more variables: Rel3 &lt;dbl&gt;, Abortion &lt;dbl&gt;, Marriage &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StemCell &lt;dbl&gt;, RestrictAbortion &lt;dbl&gt;, Marijuana &lt;dbl&gt;, FreeMarket &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   RichTax &lt;dbl&gt;, StLiving &lt;dbl&gt;, Profit &lt;dbl&gt;, PrivSocialSec &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ReportedCycleLength &lt;dbl&gt;, Vote &lt;dbl&gt;, Donate &lt;dbl&gt;, DateTesting &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StartDateofLastPeriod &lt;date&gt;, StartDateofPeriodBeforeLast &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StartDateNext &lt;date&gt;, FiscConsComp &lt;dbl&gt;, SocConsComp &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ComputedCycleLength &lt;drtn&gt;, CycleDay &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_universe</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Relationship</span>, y <span class="op">=</span> <span class="va">Rel1</span> <span class="op">+</span> <span class="va">Rel2</span> <span class="op">+</span> <span class="va">Rel3</span>, color <span class="op">=</span> <span class="va">Fertility</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>, fun.data <span class="op">=</span> <span class="st">"mean_se"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-durante_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></p>
<p>However, there also exists other valid processing options: instead of
calculating
<code>NextMenstrualOnset = StartDateofLastPeriod + ComputedCycleLength</code>,
it can also be calculated as
<code>StartDateofLastPeriod + ReportedCycleLength</code>. Such alternate
processing options can exist for several decisions that a researcher
makes in the data processing, analysis and presentation stages. This can
thus result in a <em>multiverse of analysis</em>, with the one described
above representing a single <em>universe</em>.</p>
<p>Below, we describe how our package allows you to conduct a multiverse
analysis with ease.</p>
</div>
<div class="section level2">
<h2 id="multiverse-implementation">Multiverse implementation<a class="anchor" aria-label="anchor" href="#multiverse-implementation"></a>
</h2>
<p><code>multiverse</code> provides flexible functions which can be used
to perform a multiverse analysis.</p>
<p>The first step is to define a <em>new multiverse</em>. We will use
the multiverse object to create a set of universes, each representing a
different way of analysing our data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multiverse.html">multiverse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to define our possible analyses inside the
multiverse. The <code>multiverse</code> package includes functions that
aim to make it easy to write multiverse analyses in as close a way to a
single universe analysis as possible (as seen in the single analysis
shown above).</p>
<p>Consider these first few lines from the transformation code in the
single analysis above:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data.raw.study2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ComputedCycleLength <span class="op">=</span> <span class="va">StartDateofLastPeriod</span> <span class="op">-</span> <span class="va">StartDateofPeriodBeforeLast</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NextMenstrualOnset <span class="op">=</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ComputedCycleLength</span><span class="op">)</span></span></code></pre></div>
<p>But <code>NextMenstrualOnset</code> could be calculated in at least
two other reasonable ways:</p>
<ul>
<li><code>NextMenstrualOnset = StartDateofLastPeriod + ReportedCycleLength</code></li>
<li><code>NextMenstrualOnset = StartDateNext</code></li>
</ul>
<p>To create a multiverse that includes these three possible processing
options, we can use the <code><a href="../reference/branch.html">branch()</a></code> function. The
<code><a href="../reference/branch.html">branch()</a></code> function defines a <em>parameter</em> (here
<code>menstrual_calculation</code>) and the different <em>options</em>
that the parameter can take (here, <code>"mc_option1"</code>,
<code>"mc_option2"</code>, <code>"mc_option3"</code>). Each option
corresponds to a different chunk of code that would be executed in a
different universe.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NextMenstrualOnset</span> <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">menstrual_calculation</span>, </span>
<span>  <span class="st">"mc_option1"</span> <span class="op">~</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ComputedCycleLength</span>,</span>
<span>  <span class="st">"mc_option2"</span> <span class="op">~</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ReportedCycleLength</span>,</span>
<span>  <span class="st">"mc_option3"</span> <span class="op">~</span> <span class="va">StartDateNext</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/branch.html">branch()</a></code> function indicates that, <em>in our
multiverse</em>, NextMenstrualOnset can take either of the three options
(here, <code>"mc_option1"</code>, <code>"mc_option2"</code>,
<code>"mc_option3"</code>). Thus, we need to declare this data
processing step inside the multiverse. We do this by using the
<code><a href="../reference/inside.html">inside()</a></code> function. The <code><a href="../reference/inside.html">inside()</a></code> function takes
in two arguments: 1. the multiverse object, M; and 2. the code for the
analysis (including branches). Note that if you are passing multiple
expressions, they should be enclosed within <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># here we just create the variable `df` in the multiverse</span></span>
<span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M</span>, <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data.raw.study2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># here, we perform two `mutate` operations in the multiverse.</span></span>
<span><span class="co"># although they could have been chained, this illustrates </span></span>
<span><span class="co"># how multiple variables can be declared together using the `{}`</span></span>
<span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M</span>, <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> ComputedCycleLength <span class="op">=</span> <span class="va">StartDateofLastPeriod</span> <span class="op">-</span> <span class="va">StartDateofPeriodBeforeLast</span> <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> NextMenstrualOnset <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">menstrual_calculation</span>, </span>
<span>      <span class="st">"mc_option1"</span> <span class="op">~</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ComputedCycleLength</span>,</span>
<span>      <span class="st">"mc_option2"</span> <span class="op">~</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ReportedCycleLength</span>,</span>
<span>      <span class="st">"mc_option3"</span> <span class="op">~</span> <span class="va">StartDateNext</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h4>
<p>In this vignette, we make use of the function which is more suited
for a script-style implementation. Keeping consistency with the
interactive programming interface of RStudio, we also offer the user <a href="https://mucollective.github.io/multiverse/articles/multiverse-in-rmd.html" class="external-link"><em>multiverse
code chunks</em></a>, a custom engine designed to work with the
multiverse package, to implement the multiverse analyses. <a href="https://mucollective.github.io/multiverse/articles/multiverse-in-rmd.html" class="external-link"><em>multiverse
code chunks</em></a> can be used instead of the <code>r</code> code
block to write code inside a multiverse object. See or refer to the
vignette (<code><a href="../articles/multiverse-in-rmd.html">vignette("multiverse-in-rmd")</a></code>) for more details
on using the multiverse with RMarkdown.</p>
</div>
<div class="section level3">
<h3 id="the-multiverse-with-declared-code-and-branches">The multiverse, with declared code and branches<a class="anchor" aria-label="anchor" href="#the-multiverse-with-declared-code-and-branches"></a>
</h3>
<p>Once you add the code to the multiverse, it automatically parses the
code to identify the <code>parameters</code> and the corresponding
<code>options</code> that have been defined for each parameter.</p>
<p>Once the code has been added, the <code>multiverse</code> object will
have the following attributes:</p>
<ol style="list-style-type: decimal">
<li>
<code>parameters</code>, which is a list of parameters</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">parameters</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $menstrual_calculation</span></span>
<span><span class="co">## $menstrual_calculation[[1]]</span></span>
<span><span class="co">## [1] "mc_option1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $menstrual_calculation[[2]]</span></span>
<span><span class="co">## [1] "mc_option2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $menstrual_calculation[[3]]</span></span>
<span><span class="co">## [1] "mc_option3"</span></span></code></pre>
<ol start="2" style="list-style-type: decimal">
<li>
<code>conditions</code>, which is a list of conditions (we’ll define
this later)</li>
<li>
<code>expand</code>, which is a tibble consisting of all possible
combination of values for the multiverse</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">##   .universe menstrual_calculation .parameter_assignment .code        .results</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 mc_option1            <span style="color: #949494;">&lt;named list [1]&gt;</span>      <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;env&gt;</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2 mc_option2            <span style="color: #949494;">&lt;named list [1]&gt;</span>      <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;env&gt;</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3 mc_option3            <span style="color: #949494;">&lt;named list [1]&gt;</span>      <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;env&gt;</span>   </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: .errors &lt;list&gt;</span></span></span></code></pre>
<ol start="4" style="list-style-type: decimal">
<li>
<code>code</code>, which is the code that the user passes to the
multiverse to conduct a multiverse analysis. However, we do not execute
this code and it is stored unevaluated. The user can interactively edit
and rewrite this code, and can execute it for the current analysis or
the entire multiverse using dedicated functions.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">code</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## df <span style="color: #00BB00;">&lt;-</span> data.raw.study2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## df <span style="color: #00BB00;">&lt;-</span> <span style="color: #00BBBB;">mutate</span><span style="color: #BBBB00;">(</span>df,</span></span>
<span><span class="co">##   ComputedCycleLength = StartDateofLastPeriod <span style="color: #00BB00;">-</span> StartDateofPeriodBeforeLast</span></span>
<span><span class="co">## <span style="color: #BBBB00;">)</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## df <span style="color: #00BB00;">&lt;-</span> <span style="color: #00BBBB;">mutate</span><span style="color: #BBBB00;">(</span>df,</span></span>
<span><span class="co">##   NextMenstrualOnset = <span style="color: #00BBBB;">branch</span><span style="color: #0000BB;">(</span></span></span>
<span><span class="co">##     menstrual_calculation,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"mc_option1"</span> <span style="color: #00BB00;">~</span> StartDateofLastPeriod <span style="color: #00BB00;">+</span> ComputedCycleLength,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"mc_option2"</span> <span style="color: #00BB00;">~</span> StartDateofLastPeriod <span style="color: #00BB00;">+</span> ReportedCycleLength,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"mc_option3"</span> <span style="color: #00BB00;">~</span> StartDateNext</span></span>
<span><span class="co">##   <span style="color: #0000BB;">)</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">)</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="running-a-single-analysis-from-the-multiverse">Running a single analysis from the multiverse<a class="anchor" aria-label="anchor" href="#running-a-single-analysis-from-the-multiverse"></a>
</h3>
<p>At this point, we have defined three possible processing options
(three universes) in our multiverse. Although we don’t execute all the
universes in the multiverses once they are defined, we do run the
default analysis (i.e. the first row in the multiverse table). We can
extract objects from the default analysis using the <code>$</code>
operator.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span><span class="op">$</span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 502 × 28</span></span></span>
<span><span class="co">##    WorkerID  Rel1  Rel2  Rel3 Abortion Marriage StemCell RestrictAbortion</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        1     8     8     7        6        7        1                7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        2     8     7     7        1        2        3                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        3     6     6     2        5        1        2                4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        4     7     8     6        1        5        2                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        5     7     7     9        1        1        4                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        6     9     9     9        7        7        2                7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        7     5     8     5        3        4        3                5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        8     1     1     1        1        1        2                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        9     7     7     7        5        1        2                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>       10     6     6     6        3        5        3                1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 492 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 20 more variables: Marijuana &lt;dbl&gt;, FreeMarket &lt;dbl&gt;, RichTax &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StLiving &lt;dbl&gt;, Profit &lt;dbl&gt;, PrivSocialSec &lt;dbl&gt;, Sure1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Sure2 &lt;dbl&gt;, Relationship &lt;dbl&gt;, ReportedCycleLength &lt;dbl&gt;, Vote &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Donate &lt;dbl&gt;, DateTesting &lt;date&gt;, StartDateofLastPeriod &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StartDateofPeriodBeforeLast &lt;date&gt;, StartDateNext &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   FiscConsComp &lt;dbl&gt;, SocConsComp &lt;dbl&gt;, ComputedCycleLength &lt;drtn&gt;, …</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="a-multiverse-with-all-possible-combinations-specified">A multiverse with all possible combinations specified<a class="anchor" aria-label="anchor" href="#a-multiverse-with-all-possible-combinations-specified"></a>
</h3>
<p>Besides calculating the onset of the next menstruation cycle, there
are other variables which have multiple valid and reasonable processing
options. These include defining <code>Relationship</code> and
<code>Fertility</code>, and exclusion criteria based on the values for
cycle length and certainty of responses. The next code chunk illustrates
how this can be added to the multiverse object defined above.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M</span>, <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>RelationshipStatus <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span> <span class="va">relationship_status</span>, </span>
<span>        <span class="st">"rs_option1"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Relationship</span><span class="op">==</span><span class="fl">2</span>, <span class="st">'Single'</span>, <span class="st">'Relationship'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"rs_option2"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">1</span>, <span class="st">'Single'</span>, <span class="st">'Relationship'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"rs_option3"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">1</span>, <span class="st">'Single'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">3</span> <span class="op">|</span> <span class="va">Relationship</span><span class="op">==</span><span class="fl">4</span>, <span class="st">'Relationship'</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        CycleDay <span class="op">=</span> <span class="fl">28</span> <span class="op">-</span> <span class="op">(</span><span class="va">NextMenstrualOnset</span> <span class="op">-</span> <span class="va">DateTesting</span><span class="op">)</span>,</span>
<span>        CycleDay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">WorkerID</span> <span class="op">==</span> <span class="fl">15</span>, <span class="fl">11</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">WorkerID</span> <span class="op">==</span> <span class="fl">16</span>, <span class="fl">18</span>, <span class="va">CycleDay</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        CycleDay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;</span> <span class="fl">28</span>, <span class="va">CycleDay</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">cycle_length</span>, </span>
<span>        <span class="st">"cl_option1"</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"cl_option2"</span> <span class="op">~</span> <span class="va">ComputedCycleLength</span> <span class="op">&gt;</span> <span class="fl">25</span> <span class="op">&amp;</span> <span class="va">ComputedCycleLength</span> <span class="op">&lt;</span> <span class="fl">35</span>,</span>
<span>        <span class="st">"cl_option3"</span> <span class="op">~</span> <span class="va">ReportedCycleLength</span> <span class="op">&gt;</span> <span class="fl">25</span> <span class="op">&amp;</span> <span class="va">ReportedCycleLength</span> <span class="op">&lt;</span> <span class="fl">35</span></span>
<span>      <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">certainty</span>,</span>
<span>        <span class="st">"cer_option1"</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"cer_option2"</span> <span class="op">~</span> <span class="va">Sure1</span> <span class="op">&gt;</span> <span class="fl">6</span> <span class="op">|</span> <span class="va">Sure2</span> <span class="op">&gt;</span> <span class="fl">6</span></span>
<span>      <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> Fertility <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span> <span class="va">fertile</span>,</span>
<span>        <span class="st">"fer_option1"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">14</span>, <span class="st">"high"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">17</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">25</span>, <span class="st">"low"</span>, <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option2"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">6</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">14</span>, <span class="st">"high"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">17</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">27</span>, <span class="st">"low"</span>, <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option3"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">9</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">17</span>, <span class="st">"high"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">25</span>, <span class="st">"low"</span>, <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option4"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">14</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option5"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">17</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span> <span class="op">)</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Since the multiverse object has already been created and the one
parameter has already been defined, the inside function will add to the
previous code.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">code</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## df <span style="color: #00BB00;">&lt;-</span> data.raw.study2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## df <span style="color: #00BB00;">&lt;-</span> <span style="color: #00BBBB;">mutate</span><span style="color: #BBBB00;">(</span>df,</span></span>
<span><span class="co">##   ComputedCycleLength = StartDateofLastPeriod <span style="color: #00BB00;">-</span> StartDateofPeriodBeforeLast</span></span>
<span><span class="co">## <span style="color: #BBBB00;">)</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## df <span style="color: #00BB00;">&lt;-</span> <span style="color: #00BBBB;">mutate</span><span style="color: #BBBB00;">(</span>df,</span></span>
<span><span class="co">##   NextMenstrualOnset = <span style="color: #00BBBB;">branch</span><span style="color: #0000BB;">(</span></span></span>
<span><span class="co">##     menstrual_calculation,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"mc_option1"</span> <span style="color: #00BB00;">~</span> StartDateofLastPeriod <span style="color: #00BB00;">+</span> ComputedCycleLength,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"mc_option2"</span> <span style="color: #00BB00;">~</span> StartDateofLastPeriod <span style="color: #00BB00;">+</span> ReportedCycleLength,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"mc_option3"</span> <span style="color: #00BB00;">~</span> StartDateNext</span></span>
<span><span class="co">##   <span style="color: #0000BB;">)</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">)</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## df <span style="color: #00BB00;">&lt;-</span> <span style="color: #00BBBB;">mutate</span><span style="color: #BBBB00;">(</span></span></span>
<span><span class="co">##   <span style="color: #00BBBB;">filter</span><span style="color: #0000BB;">(</span></span></span>
<span><span class="co">##     <span style="color: #00BBBB;">filter(</span></span></span>
<span><span class="co">##       <span style="color: #00BBBB;">mutate</span><span style="color: #BBBB00;">(</span></span></span>
<span><span class="co">##         <span style="color: #00BBBB;">mutate</span><span style="color: #0000BB;">(</span>df,</span></span>
<span><span class="co">##           RelationshipStatus = <span style="color: #00BBBB;">branch(</span></span></span>
<span><span class="co">##             relationship_status,</span></span>
<span><span class="co">##             <span style="color: #BBBB00;">"rs_option1"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor</span><span style="color: #BBBB00;">(</span><span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>Relationship <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">1</span> <span style="color: #00BB00;">|</span> Relationship <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">2</span>, <span style="color: #BBBB00;">"Single"</span>, <span style="color: #BBBB00;">"Relationship"</span><span style="color: #0000BB;">)</span><span style="color: #BBBB00;">)</span>,</span></span>
<span><span class="co">##             <span style="color: #BBBB00;">"rs_option2"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor</span><span style="color: #BBBB00;">(</span><span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>Relationship <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">1</span>, <span style="color: #BBBB00;">"Single"</span>, <span style="color: #BBBB00;">"Relationship"</span><span style="color: #0000BB;">)</span><span style="color: #BBBB00;">)</span>,</span></span>
<span><span class="co">##             <span style="color: #BBBB00;">"rs_option3"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor</span><span style="color: #BBBB00;">(</span><span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>Relationship <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">1</span>,</span></span>
<span><span class="co">##               <span style="color: #BBBB00;">"Single"</span>,</span></span>
<span><span class="co">##               <span style="color: #00BBBB;">ifelse(</span>Relationship <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">3</span> <span style="color: #00BB00;">|</span> Relationship <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">4</span>, <span style="color: #BBBB00;">"Relationship"</span>, <span style="color: #0000BB;">NA</span><span style="color: #00BBBB;">)</span></span></span>
<span><span class="co">##             <span style="color: #0000BB;">)</span><span style="color: #BBBB00;">)</span></span></span>
<span><span class="co">##           <span style="color: #00BBBB;">)</span></span></span>
<span><span class="co">##         <span style="color: #0000BB;">)</span>,</span></span>
<span><span class="co">##         CycleDay = <span style="color: #0000BB;">28</span> <span style="color: #00BB00;">-</span> <span style="color: #0000BB;">(</span>NextMenstrualOnset <span style="color: #00BB00;">-</span> DateTesting<span style="color: #0000BB;">)</span>,</span></span>
<span><span class="co">##         CycleDay = <span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>WorkerID <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">15</span>, <span style="color: #0000BB;">11</span>, <span style="color: #00BBBB;">ifelse(</span>WorkerID <span style="color: #00BB00;">==</span> <span style="color: #0000BB;">16</span>, <span style="color: #0000BB;">18</span>, CycleDay<span style="color: #00BBBB;">)</span><span style="color: #0000BB;">)</span>,</span></span>
<span><span class="co">##         CycleDay = <span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>CycleDay <span style="color: #00BB00;">&gt;</span> <span style="color: #0000BB;">1</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;</span> <span style="color: #0000BB;">28</span>, CycleDay, <span style="color: #00BBBB;">ifelse(</span>CycleDay <span style="color: #00BB00;">&lt;</span> <span style="color: #0000BB;">1</span>, <span style="color: #0000BB;">1</span>, <span style="color: #0000BB;">28</span><span style="color: #00BBBB;">)</span><span style="color: #0000BB;">)</span></span></span>
<span><span class="co">##       <span style="color: #BBBB00;">)</span>,</span></span>
<span><span class="co">##       <span style="color: #00BBBB;">branch</span><span style="color: #BBBB00;">(</span></span></span>
<span><span class="co">##         cycle_length,</span></span>
<span><span class="co">##         <span style="color: #BBBB00;">"cl_option1"</span> <span style="color: #00BB00;">~</span> <span style="color: #0000BB;">TRUE</span>,</span></span>
<span><span class="co">##         <span style="color: #BBBB00;">"cl_option2"</span> <span style="color: #00BB00;">~</span> ComputedCycleLength <span style="color: #00BB00;">&gt;</span> <span style="color: #0000BB;">25</span> <span style="color: #00BB00;">&amp;</span> ComputedCycleLength <span style="color: #00BB00;">&lt;</span> <span style="color: #0000BB;">35</span>,</span></span>
<span><span class="co">##         <span style="color: #BBBB00;">"cl_option3"</span> <span style="color: #00BB00;">~</span> ReportedCycleLength <span style="color: #00BB00;">&gt;</span> <span style="color: #0000BB;">25</span> <span style="color: #00BB00;">&amp;</span> ReportedCycleLength <span style="color: #00BB00;">&lt;</span> <span style="color: #0000BB;">35</span></span></span>
<span><span class="co">##       <span style="color: #BBBB00;">)</span></span></span>
<span><span class="co">##     <span style="color: #00BBBB;">)</span>,</span></span>
<span><span class="co">##     <span style="color: #00BBBB;">branch(</span></span></span>
<span><span class="co">##       certainty,</span></span>
<span><span class="co">##       <span style="color: #BBBB00;">"cer_option1"</span> <span style="color: #00BB00;">~</span> <span style="color: #0000BB;">TRUE</span>,</span></span>
<span><span class="co">##       <span style="color: #BBBB00;">"cer_option2"</span> <span style="color: #00BB00;">~</span> Sure1 <span style="color: #00BB00;">&gt;</span> <span style="color: #0000BB;">6</span> <span style="color: #00BB00;">|</span> Sure2 <span style="color: #00BB00;">&gt;</span> <span style="color: #0000BB;">6</span></span></span>
<span><span class="co">##     <span style="color: #00BBBB;">)</span></span></span>
<span><span class="co">##   <span style="color: #0000BB;">)</span>,</span></span>
<span><span class="co">##   Fertility = <span style="color: #00BBBB;">branch</span><span style="color: #0000BB;">(</span></span></span>
<span><span class="co">##     fertile,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"fer_option1"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor(ifelse</span><span style="color: #BBBB00;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">7</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">14</span>,</span></span>
<span><span class="co">##       <span style="color: #BBBB00;">"high"</span>,</span></span>
<span><span class="co">##       <span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">17</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">25</span>, <span style="color: #BBBB00;">"low"</span>, <span style="color: #BBBB00;">"medium"</span><span style="color: #0000BB;">)</span></span></span>
<span><span class="co">##     <span style="color: #BBBB00;">)</span><span style="color: #00BBBB;">)</span>,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"fer_option2"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor(ifelse</span><span style="color: #BBBB00;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">6</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">14</span>,</span></span>
<span><span class="co">##       <span style="color: #BBBB00;">"high"</span>,</span></span>
<span><span class="co">##       <span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">17</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">27</span>, <span style="color: #BBBB00;">"low"</span>, <span style="color: #BBBB00;">"medium"</span><span style="color: #0000BB;">)</span></span></span>
<span><span class="co">##     <span style="color: #BBBB00;">)</span><span style="color: #00BBBB;">)</span>,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"fer_option3"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor(ifelse</span><span style="color: #BBBB00;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">9</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">17</span>,</span></span>
<span><span class="co">##       <span style="color: #BBBB00;">"high"</span>,</span></span>
<span><span class="co">##       <span style="color: #00BBBB;">ifelse</span><span style="color: #0000BB;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">18</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">25</span>, <span style="color: #BBBB00;">"low"</span>, <span style="color: #BBBB00;">"medium"</span><span style="color: #0000BB;">)</span></span></span>
<span><span class="co">##     <span style="color: #BBBB00;">)</span><span style="color: #00BBBB;">)</span>,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"fer_option4"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor(ifelse</span><span style="color: #BBBB00;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">8</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">14</span>, <span style="color: #BBBB00;">"high"</span>, <span style="color: #BBBB00;">"low")</span><span style="color: #00BBBB;">)</span>,</span></span>
<span><span class="co">##     <span style="color: #BBBB00;">"fer_option5"</span> <span style="color: #00BB00;">~</span> <span style="color: #00BBBB;">factor(ifelse</span><span style="color: #BBBB00;">(</span>CycleDay <span style="color: #00BB00;">&gt;=</span> <span style="color: #0000BB;">8</span> <span style="color: #00BB00;">&amp;</span> CycleDay <span style="color: #00BB00;">&lt;=</span> <span style="color: #0000BB;">17</span>, <span style="color: #BBBB00;">"high"</span>, <span style="color: #BBBB00;">"low")</span><span style="color: #00BBBB;">)</span></span></span>
<span><span class="co">##   <span style="color: #0000BB;">)</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">)</span></span></span></code></pre>
<p>The <code>expand</code> will contain all the possible combinations of
the parameter options that have been identified.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">##   .universe menstrual_calculation relationship_status cycle_length certainty  </span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 mc_option1            rs_option1          cl_option1   cer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         2 mc_option1            rs_option1          cl_option1   cer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         3 mc_option1            rs_option1          cl_option1   cer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>         4 mc_option1            rs_option1          cl_option1   cer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>         5 mc_option1            rs_option1          cl_option1   cer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>         6 mc_option1            rs_option1          cl_option1   cer_option2</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: fertile &lt;chr&gt;, .parameter_assignment &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   .code &lt;list&gt;, .results &lt;list&gt;, .errors &lt;list&gt;</span></span></span></code></pre>
<p>In our multiverse we have identified 5 options for calculating
<code>fertility</code>, 3 options for calculating
<code>menstrual calculation</code> and <code>relationship status</code>
each, 3 wyas of excluding participants based on their
<code>cycle length</code> and 2 ways of excluding participants based on
the self-reported <code>certainty</code> of their responses.</p>
<p>This results in $ 5 = 270$ possible combinations.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 270</span></span></code></pre>
<p>We can then inspect the default analysis the default single universe
analysis from this multiverse:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span><span class="op">$</span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 31</span></span></span>
<span><span class="co">##   WorkerID  Rel1  Rel2  Rel3 Abortion Marriage StemCell RestrictAbortion</span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>        1     8     8     7        6        7        1                7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>        2     8     7     7        1        2        3                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>        3     6     6     2        5        1        2                4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>        4     7     8     6        1        5        2                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>        5     7     7     9        1        1        4                1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>        6     9     9     9        7        7        2                7</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 23 more variables: Marijuana &lt;dbl&gt;, FreeMarket &lt;dbl&gt;, RichTax &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StLiving &lt;dbl&gt;, Profit &lt;dbl&gt;, PrivSocialSec &lt;dbl&gt;, Sure1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Sure2 &lt;dbl&gt;, Relationship &lt;dbl&gt;, ReportedCycleLength &lt;dbl&gt;, Vote &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Donate &lt;dbl&gt;, DateTesting &lt;date&gt;, StartDateofLastPeriod &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   StartDateofPeriodBeforeLast &lt;date&gt;, StartDateNext &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   FiscConsComp &lt;dbl&gt;, SocConsComp &lt;dbl&gt;, ComputedCycleLength &lt;drtn&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   NextMenstrualOnset &lt;date&gt;, RelationshipStatus &lt;fct&gt;, CycleDay &lt;dbl&gt;, …</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="specifying-conditions-in-the-multiverse-analysis">Specifying conditions in the multiverse analysis<a class="anchor" aria-label="anchor" href="#specifying-conditions-in-the-multiverse-analysis"></a>
</h3>
<p>In a multiverse analysis, it may occur that the value of one variable
might depend on the value of another variable defined previously. For
example, in our example, depending on how we filter participants based
on <em>cycle length</em>, we can only the corresponding value for
calculating participants’ <code>NextMenstrualOnset</code>. In other
words, if we are using <code>ComputedCycleLength</code> to exclude
participants, this means that we should not calculate the variable
<code>NextMenstrualOnset</code> (date for the onset of the next
menstrual cycle) using the <code>ReportedCycleLength</code> value.
Similarly, if we are using <code>ReportedCycleLength</code> to exclude
participants it is inconsistent to calculate
<code>NextMenstrualOnset</code> using
<code>ComputedCycleLength</code>.</p>
<p>We can express these conditionals in the multiverse (See
vignette(“Conditions”) for more details). Below, we use the %when%
operator:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data.raw.study2</span>  <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> ComputedCycleLength <span class="op">=</span> <span class="va">StartDateofLastPeriod</span> <span class="op">-</span> <span class="va">StartDateofPeriodBeforeLast</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NextMenstrualOnset <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">menstrual_calculation</span>,</span>
<span>            <span class="st">"mc_option1"</span> <span class="op">~</span> <span class="op">(</span><span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ComputedCycleLength</span><span class="op">)</span> <span class="op"><a href="../reference/conditionals.html">%when%</a></span> <span class="op">(</span><span class="va">cycle_length</span> <span class="op">!=</span> <span class="st">"cl_option3"</span><span class="op">)</span>,</span>
<span>            <span class="st">"mc_option2"</span> <span class="op">~</span> <span class="op">(</span><span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ReportedCycleLength</span><span class="op">)</span> <span class="op"><a href="../reference/conditionals.html">%when%</a></span> <span class="op">(</span><span class="va">cycle_length</span> <span class="op">!=</span> <span class="st">"cl_option2"</span><span class="op">)</span>,</span>
<span>            <span class="st">"mc_option3"</span> <span class="op">~</span> <span class="va">StartDateNext</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h3>
<p>Specifying these conditions allows us to exclude inconsistent
combinations from our analyses. Let’s update our example by including
these conditions:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">=</span> <span class="fu"><a href="../reference/multiverse.html">multiverse</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M</span>, <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data.raw.study2</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> ComputedCycleLength <span class="op">=</span> <span class="va">StartDateofLastPeriod</span> <span class="op">-</span> <span class="va">StartDateofPeriodBeforeLast</span> <span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">cycle_length</span>,</span>
<span>        <span class="st">"cl_option1"</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"cl_option2"</span> <span class="op">~</span> <span class="va">ComputedCycleLength</span> <span class="op">&gt;</span> <span class="fl">25</span> <span class="op">&amp;</span> <span class="va">ComputedCycleLength</span> <span class="op">&lt;</span> <span class="fl">35</span>,</span>
<span>        <span class="st">"cl_option3"</span> <span class="op">~</span> <span class="va">ReportedCycleLength</span> <span class="op">&gt;</span> <span class="fl">25</span> <span class="op">&amp;</span> <span class="va">ReportedCycleLength</span> <span class="op">&lt;</span> <span class="fl">35</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">certainty</span>,</span>
<span>        <span class="st">"cer_option1"</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"cer_option2"</span> <span class="op">~</span> <span class="va">Sure1</span> <span class="op">&gt;</span> <span class="fl">6</span> <span class="op">|</span> <span class="va">Sure2</span> <span class="op">&gt;</span> <span class="fl">6</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NextMenstrualOnset <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">menstrual_calculation</span>,</span>
<span>        <span class="st">"mc_option1"</span> <span class="op"><a href="../reference/conditionals.html">%when%</a></span> <span class="op">(</span><span class="va">cycle_length</span> <span class="op">!=</span> <span class="st">"cl_option3"</span><span class="op">)</span> <span class="op">~</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ComputedCycleLength</span>,</span>
<span>        <span class="st">"mc_option2"</span> <span class="op"><a href="../reference/conditionals.html">%when%</a></span> <span class="op">(</span><span class="va">cycle_length</span> <span class="op">!=</span> <span class="st">"cl_option2"</span><span class="op">)</span> <span class="op">~</span> <span class="va">StartDateofLastPeriod</span> <span class="op">+</span> <span class="va">ReportedCycleLength</span>,</span>
<span>        <span class="st">"mc_option3"</span> <span class="op">~</span> <span class="va">StartDateNext</span><span class="op">)</span></span>
<span>    <span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      CycleDay <span class="op">=</span> <span class="fl">28</span> <span class="op">-</span> <span class="op">(</span><span class="va">NextMenstrualOnset</span> <span class="op">-</span> <span class="va">DateTesting</span><span class="op">)</span>,</span>
<span>      CycleDay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">WorkerID</span> <span class="op">==</span> <span class="fl">15</span>, <span class="fl">11</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">WorkerID</span> <span class="op">==</span> <span class="fl">16</span>, <span class="fl">18</span>, <span class="va">CycleDay</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      CycleDay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;</span> <span class="fl">28</span>, <span class="va">CycleDay</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> Fertility <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span> <span class="va">fertile</span>,</span>
<span>        <span class="st">"fer_option1"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">14</span>, <span class="st">"high"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">17</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">25</span>, <span class="st">"low"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option2"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">6</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">14</span>, <span class="st">"high"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">17</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">27</span>, <span class="st">"low"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option3"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">9</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">17</span>, <span class="st">"high"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">25</span>, <span class="st">"low"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option4"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">14</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>        <span class="st">"fer_option5"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CycleDay</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">CycleDay</span> <span class="op">&lt;=</span> <span class="fl">17</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>RelationshipStatus <span class="op">=</span> <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span><span class="va">relationship_status</span>,</span>
<span>        <span class="st">"rs_option1"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Relationship</span><span class="op">==</span><span class="fl">2</span>, <span class="st">'Single'</span>, <span class="st">'Relationship'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"rs_option2"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">1</span>, <span class="st">'Single'</span>, <span class="st">'Relationship'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="st">"rs_option3"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">1</span>, <span class="st">'Single'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Relationship</span><span class="op">==</span><span class="fl">3</span> <span class="op">|</span> <span class="va">Relationship</span><span class="op">==</span><span class="fl">4</span>, <span class="st">'Relationship'</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>After excluding the inconsistent choice combinations,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>270</mn><mo>−</mo><mn>2</mn><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo>×</mo><mn>1</mn><mo>×</mo><mn>3</mn><mo>×</mo><mn>1</mn><mo>×</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>210</mn></mrow><annotation encoding="application/x-tex">270 − 2 \times (5 \times 1 \times 3 \times 1 \times 2) = 210</annotation></semantics></math>
choice combinations remain:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 210</span></span></code></pre>
<p>Now, we’ve created the complete multiverse that was presented as
example #2 from Steegen et al.’s paper.</p>
</div>
</div>
<div class="section level2">
<h2 id="modeling">Modeling<a class="anchor" aria-label="anchor" href="#modeling"></a>
</h2>
<p>Steegen et al. create 6 models. The first model uses data from
example #1. The other five models use the data from example #2, which
we’ve using so far.</p>
<div class="section level3">
<h3 id="model-2-effect-of-fertility-and-relationship-status-on-religiosity">Model #2: Effect of Fertility and Relationship status on
Religiosity<a class="anchor" aria-label="anchor" href="#model-2-effect-of-fertility-and-relationship-status-on-religiosity"></a>
</h3>
<p>The authors compute a composite score of Religiosity by calculating
the average of the three Religiosity items.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M</span>, <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> RelComp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">Rel1</span> <span class="op">+</span> <span class="va">Rel2</span> <span class="op">+</span> <span class="va">Rel3</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The authors perform an ANOVA to study the effect of
<em>Fertility</em>, <em>Relationship</em> and their interaction term, on
the composite Religiosity score. We fit the linear model using the call:
<code>lm( RelComp ~ Fertility * RelationshipStatus, data = df )</code>
inside our multiverse and save the result to a variable called
<code>fit_RelComp</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M</span>, <span class="op">{</span></span>
<span>  <span class="va">fit_RelComp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">RelComp</span> <span class="op">~</span> <span class="va">Fertility</span> <span class="op">*</span> <span class="va">RelationshipStatus</span>, data <span class="op">=</span> <span class="va">df</span> <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>To extract the results from the analysis, we first create a tidy
data-frame of the results of the model, using <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy</a></code>.
Recall that declaring a variable in the multiverse only executes it in
the default universe, and hence we need to call
<code><a href="../reference/execute.html">execute_multiverse()</a></code> to execute our analysis in each
multiverse.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inside.html">inside</a></span><span class="op">(</span><span class="va">M</span>, <span class="op">{</span></span>
<span>  <span class="va">summary_RelComp</span> <span class="op">&lt;-</span> <span class="va">fit_RelComp</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span> conf.int <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/execute.html">execute_multiverse</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have performed the analysis in each universe of the
multiverse, we need to plot the data. To plot the data, we need to
extract the relevant result data-frame from each universe into a single
data-frame. The following code does this, by extracting the variable
where the estimates of the model are stored,
<code>summary_RelComp</code> and creating a single tidy data-frame that
can be accessed easily.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_variables.html">extract_variables</a></span><span class="op">(</span><span class="va">summary_RelComp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span> cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">summary_RelComp</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span> <span class="fl">10</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 17</span></span></span>
<span><span class="co">##    .universe cycle_length certainty   menstrual_calculation fertile    </span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>         1 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>         1 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>         1 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>         1 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>         2 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>         2 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>         2 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>         2 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>         3 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>         3 cl_option1   cer_option1 mc_option1            fer_option1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 12 more variables: relationship_status &lt;chr&gt;, .parameter_assignment &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   .code &lt;list&gt;, .results &lt;list&gt;, .errors &lt;list&gt;, term &lt;chr&gt;, estimate &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   std.error &lt;dbl&gt;, statistic &lt;dbl&gt;, p.value &lt;dbl&gt;, conf.low &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   conf.high &lt;dbl&gt;</span></span></span></code></pre>
<p>We then take this data frame and plot the results as a confidence
interval and point estimate using <code>ggplot2</code>. As you can see,
this is similar to how you would plot a point estimate and confidence
intervals for a regular analysis. We then use <code>gganimate</code> to
animate through the results of each universe to quickly get an overview
of the robustness of the results.</p>
<p>Note: we discuss extracting results from the multiverse and
visualising them in more detail in
<code>vignette(visualising-multiverse)</code></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/accessors.html">expand</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_variables.html">extract_variables</a></span><span class="op">(</span><span class="va">summary_RelComp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span> cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">summary_RelComp</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> term <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span> <span class="va">term</span>, </span>
<span>                 <span class="st">"RelationshipStatusSingle"</span> <span class="op">=</span> <span class="st">"Single"</span>,</span>
<span>                 <span class="st">"Fertilitylow:RelationshipStatusSingle"</span> <span class="op">=</span> <span class="st">"Single:Fertility_low"</span></span>
<span>  <span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span> <span class="va">term</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span> xintercept <span class="op">=</span> <span class="fl">0</span>,  colour <span class="op">=</span> <span class="st">'#979797'</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, y <span class="op">=</span> <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html" class="external-link">geom_errorbarh</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span>, y <span class="op">=</span> <span class="va">term</span><span class="op">)</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_manual.html" class="external-link">transition_manual</a></span><span class="op">(</span> <span class="va">.universe</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p</span>, nframes <span class="op">=</span> <span class="fl">210</span>, fps <span class="op">=</span> <span class="fl">4</span>, res <span class="op">=</span> <span class="fl">72</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/durante-regression.gif" alt="Animation of linear regression coefficients"><div class="figcaption">Animation of linear regression
coefficients</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://abhsarma.github.io" class="external-link">Abhraneel Sarma</a>, <a href="http://www.mjskay.com" class="external-link">Matthew Kay</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
