---
title: "temp"
author: "Abhraneel Sarma"
date: "2/19/2022"
output:
  html_document:
    css: ../inst/css/styles.css
  pdf_document: default
---

```{r setup, include=FALSE} 
library(dplyr)
library(tidyr)
library(purrr)
devtools::load_all(".")
```

## Multiverse case study #4

```{r}
data("durante")

data.raw.study2 = durante %>%
  mutate(
    Abortion = abs(7 - Abortion) + 1,
    StemCell = abs(7 - StemCell) + 1,
    Marijuana = abs(7 - Marijuana) + 1,
    RichTax = abs(7 - RichTax) + 1,
    StLiving = abs(7 - StLiving) + 1,
    Profit = abs(7 - Profit) + 1,
    FiscConsComp = FreeMarket + PrivSocialSec + RichTax + StLiving + Profit,
    SocConsComp = Marriage + RestrictAbortion + Abortion + StemCell + Marijuana
  )
```


## Multiverse Analysis

To implement a multiverse analysis, we first need to create the `js parameter('masfem')` object:

```{r}
M = multiverse()
```


```{multiverse default-m-1, inside = M}
df = data.raw.study2  %>%
    mutate( ComputedCycleLength = StartDateofLastPeriod - StartDateofPeriodBeforeLast )  %>%
    dplyr::filter( branch(cycle_length,
        "cl_option1" ~ TRUE,
        "cl_option2" ~ ComputedCycleLength > 25 & ComputedCycleLength < 35,
        "cl_option3" ~ ReportedCycleLength > 25 & ReportedCycleLength < 35
    ))
```

```{multiverse default-m-2, inside = M}
df = df %>%
    dplyr::filter( branch(certainty,
        "cer_option1" ~ TRUE,
        "cer_option2" ~ Sure1 > 6 | Sure2 > 6
    ))
```


```{multiverse default-m-3, inside = M}
df = df %>%
    mutate(NextMenstrualOnset = branch(menstrual_calculation,
        "mc_option1" %when% (cycle_length != "cl_option3") ~ StartDateofLastPeriod + ComputedCycleLength,
        "mc_option2" %when% (cycle_length != "cl_option2") ~ StartDateofLastPeriod + ReportedCycleLength,
        "mc_option3" ~ StartDateNext)
    )
```

```{multiverse default-m-4, inside = M}
head(df)
```

```{multiverse default-m-5, inside = M}
hist(df$Rel1)
```

```{r}
expand(M)
```

```{r}
out = evaluate::evaluate(
  input = "hist(df$damage)",
  new_device = FALSE, 
  envir = expand(M)$.results[[1]]
)
```


<SCRIPT text = "javascript">
  function parameter (name) {
    console.log(name)
  }
</SCRIPT>

